{% extends 'crm/index.html' %}

{% block title %}View Contact{% endblock %}

{% block content %}
<div class="content">
    <h1><strong>Contact Details:</strong> {{ contact.company_name }}</h1>
    <p><strong>Address:</strong> {{ contact.address }}</p>
    <p><strong>Company Type:</strong> {{ contact.get_company_type_display }}</p>

    <!-- Отображение материалов и цен -->
    <h3>Materials and Prices</h3>
    {% if contact.contact_materials.all %}
        <ul>
            {% for contact_material in contact.contact_materials.all %}
                <li>
                    {{ contact_material.material }} - ${{ contact_material.price|default:"Not set" }}
                    <a href="{% url 'edit_contact_material' contact_material.id %}">Edit</a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No materials linked to this contact.</p>
    {% endif %}

    <!-- Форма добавления нового материала -->
    <h3>Add a New Material</h3>
    <form method="POST" action="{% url 'add_contact_material' contact.id %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Add Material</button>
    </form>

    <!-- Кнопка для отображения формы редактирования контакта -->
    <button id="edit-button" onclick="toggleEditForm()">Edit Contact</button>

    <!-- Форма редактирования контакта (скрыта по умолчанию) -->
    <div id="edit-form-container" style="display: none;">
        <form class="contact-edit-form" method="POST" action="{% url 'edit_contact' contact.id %}">
            {% csrf_token %}
            {{ edit_contact_form.as_p }}
            <button type="submit">Save Changes</button>
        </form>
    </div>

    <a href="{% url 'contacts_list' %}">
        <button>Back to Contacts</button>
    </a>
</div>

<script>
    function toggleEditForm() {
        const formContainer = document.getElementById('edit-form-container');
        formContainer.style.display = formContainer.style.display === 'none' ? 'block' : 'none';
    }
</script>
{% endblock %}
