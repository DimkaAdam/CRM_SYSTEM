{% extends 'crm/index.html' %}
{% block title %}Tasks{% endblock %}
{% load static %}
{% block content %}

<div class="calendar-container">
    <!-- Мини-календарь -->
    <div id="mini-calendar">
        <div class="calendar-header">
            <button id="prev-month">&lt;</button>
            <span id="current-month">March 2025</span>
            <button id="next-month">&gt;</button>
        </div>
        <div class="weekdays">
            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
        </div>
        <div class="days" id="calendar-days"></div>

        <!-- Форма для добавления отгрузки -->
        <div id="shipment-form">
            <h3>Добавить отгрузку</h3>
            <form id="add-shipment-form">
                <label>Откуда (Поставщик):</label>
                <select id="supplier" name="supplier" required>
                    <option value="" disabled selected>Выберите поставщика</option>
                    {% for supplier in suppliers %}
                        <option value="{{ supplier.id }}">{{ supplier.name }}</option>
                    {% endfor %}
                </select>

                <label>Куда (Покупатель):</label>
                <select id="buyer" name="buyer" required>
                    <option value="" disabled selected>Выберите покупателя</option>
                    {% for buyer in buyers %}
                        <option value="{{ buyer.id }}">{{ buyer.name }}</option>
                    {% endfor %}
                </select>

                <label>Дата:</label>
                <input type="date" id="shipment-date" required>

                <label>Время:</label>
                <input type="time" id="shipment-time" required>

                <!-- Грейд (материал) -->
                <label>Грейд:</label>
                <select id="shipment-grade" name="grade" required>
                    <option value="" disabled selected>Выберите грейд</option>
                    {% for key, value in materials_list.items %}
                        <option value="{{ key }}">{{ key }}</option>
                    {% endfor %}
                </select>
                <button type="submit">Добавить</button>
            </form>
        </div>
    </div>
    <!-- Полноразмерный календарь -->
    <div id="calendar"></div>
</div>

<!-- Блок для списка отгрузок -->
<div id="shipment-list-container">
    <h3>Последние отгрузки</h3>
    <table id="shipment-list">
        <thead>
            <tr>
                <th>Дата</th>
                <th>Время</th>
                <th>Поставщик</th>
                <th>Покупатель</th>
                <th>Грейд</th>
            </tr>
        </thead>
        <tbody>
            <!-- Отгрузки будут загружаться динамически -->
        </tbody>
    </table>
</div>

<!-- Блок для списка отгрузок, сгруппированных по дням недели -->
<div id="shipment-list-container">
    <h3>Shipments by Day</h3>
    <div id="shipment-list">
        <!-- Сюда динамически будут добавляться отгрузки, разделенные по дням недели -->
    </div>
</div>


<!-- Подключаем FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

<!-- Подключаем jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="{% static 'crm/js/task_list.js' %}"></script>
<link rel="stylesheet" href="{% static 'crm/task_list.css' %}">

{% endblock %}
