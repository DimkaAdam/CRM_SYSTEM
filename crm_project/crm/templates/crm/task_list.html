{% extends 'crm/index.html' %}

{% block title %}Tasks{% endblock %}
{% load static %}
{% block content %}
<h2>Список задач и событий</h2>

<!-- Контейнер для календаря -->
<div id="calendar"></div>

<!-- FullCalendar (подключаем библиотеку) -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth', // Вид календаря (месячный)
            events: [
                {% for event in events %}
                {
                    title: "{{ event.summary }}",
                    start: "{{ event.start.dateTime|default:event.start.date }}",
                    allDay: true
                },
                {% endfor %}
            ]
        });
        calendar.render();
    });
</script>

{% if events %}
    <ul>
        {% for event in events %}
            <li>
                <strong>{{ event.summary }}</strong> <br>
                Время: {{ event.start.dateTime|default:event.start.date }} <br>
                Место: {{ event.location|default:"Не указано" }}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>Нет предстоящих событий.</p>
{% endif %}

<script src="{% static 'crm/js/task_list.js' %}"></script>
<link rel="stylesheet" href="{% static 'crm/task_list.css' %}">

{% endblock %}
