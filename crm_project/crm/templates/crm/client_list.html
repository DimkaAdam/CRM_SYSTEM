{% extends 'crm/index.html' %}

{% block title %}Список клиентов{% endblock %}

{% block content %}
    <div class="content">
        <h1>Клиенты</h1>

        <!-- Кнопка для добавления контакта -->
        <button id="addContactBtn" class="add-contact-btn">Add Contact</button>
        <!-- Кнопка Cancel рядом с Add Contact -->
        <button id="cancelBtn" class="cancel-btn" style="display: none;">Cancel</button>

         <!-- Боковая панель для формы добавления клиента -->
        <div id="addClientSidebar" class="sidebar-form">
            <div class="sidebar-header">
                <h3>Add Client</h3>
                <button id="closeSidebarBtn" class="close-btn">&times;</button>
            </div>
            <form id="clientForm">
                <label for="name"></label>
                <input type="text" id="name" placeholder="Name" required><br><br>
                <label for="email"></label>
                <input type="email" id="email" placeholder="Email" required><br><br>
                <label for="company"></label>
                <input type="text" id="company" placeholder="Company" required><br><br>
                <label for="phone"></label>
                <input type="tel" id="phone" placeholder="Phone Number" required><br><br>
                <button type="submit" class="add-btn">Add</button>
            </form>
        </div>

         <!-- Список клиентов -->
        <ul id="clientList">
            {% for client in clients %}
                <li>{{ client.name }} ({{ client.email }}) ({{ client.company }})</li>
            {% empty %}
                <li>No clients</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Скрипт для обработки открытия/закрытия боковой панели -->
    <script>
        // Открыть боковую панель
        document.getElementById('addContactBtn').addEventListener('click', function () {
            document.getElementById('addClientSidebar').style.width = '300px';
            document.getElementById('cancelBtn').style.display = 'inline-block'; // Показываем кнопку Cancel
        });

        // Закрыть боковую панель
        document.getElementById('closeSidebarBtn').addEventListener('click', function () {
            document.getElementById('addClientSidebar').style.width = '0';
            document.getElementById('cancelBtn').style.display = 'none'; // Прячем кнопку Cancel
        });

        // Кнопка Cancel - скрыть боковую панель
        document.getElementById('cancelBtn').addEventListener('click', function () {
            document.getElementById('addClientSidebar').style.width = '0';
            document.getElementById('cancelBtn').style.display = 'none'; // Прячем кнопку Cancel
        });

        // Обработать отправку формы
        document.getElementById('clientForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const company = document.getElementById('company').value;
            const phone = document.getElementById('phone').value;

            // Отправка данных на API
            fetch('http://127.0.0.1:8000/api/clients/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}',
                },
                body: JSON.stringify({
                    name: name,
                    email: email,
                    company: company,
                    phone: phone
                }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        // Добавляем нового клиента в список
                        const clientList = document.getElementById('clientList');
                        const newClient = document.createElement('li');
                        newClient.textContent = `${data.name} (${data.email}) (${data.company}) (${data.phone})`;
                        clientList.appendChild(newClient);

                        // Закрыть боковую панель
                        document.getElementById('addClientSidebar').style.width = '0';
                        document.getElementById('cancelBtn').style.display = 'none'; // Прячем кнопку Cancel
                        document.getElementById('clientForm').reset();
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    </script>
{% endblock %}
